---
title: "parseq: sensitivity analyses on sequences of parameters for mrgsolve"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, comment = '.', 
                      fig.path = "inst/img/README-")
```

```{r}
library(parseq)
```



```{r}
mod <- mread("pk1", modlib(), end = 48, delta=0.1)

param(mod)
```

## PK model sensitivity analysis by factor

The nominal (in model) parameter value is divided 
and multiplied by a factor, generating minimum and maximum 
bounds for simulating a sequence of parameter values

```{r}
mod %>% 
  ev(amt = 100) %>% 
  parseq_factor(CL,V,.n=8) %>% 
  sens_each() %>% 
  sens_plot(CP)
```

## HIV viral dynamic model

```{r}
mod <- mread("hiv", "inst/example")

mod %>% 
  update(end = 365*20) %>%
  parseq_range(N = c(900,1500), .n = 10) %>%
  sens_each() %>% 
  sens_plot(L)
```


## Sensitivity analysis on custom sequences

```{r}
mod <- mread("inst/example/rifampicin.cpp") %>% update(delta = 0.1)

mod %>% 
  ev(amt = 600) %>% 
  parseq_manual(
    SFKp = fct_seq(mod$SFKp, .n = 20), 
    Kp_muscle = even_seq(0.001,0.1, .n = 6)
  ) %>% 
  sens_each() %>% 
  sens_plot(Ccentral)
```

# Simulate a grid

To this point, we have always used `sens_each` so that each value for each 
parameter is simulated one at a time.  Now, simulate the grid or all 
combinations.

```{r, fig.height = 5}
library(ggplot2)

mod %>% 
  ev(amt = 600) %>% 
  parseq_cv(fBCLint_all_kg, SFKp, Kp_muscle, .n = 4, .cv = 50) %>% 
  sens_grid() %>% 
  sens_plot(Ccentral)
```

